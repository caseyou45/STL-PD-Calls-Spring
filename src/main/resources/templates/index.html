<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Call List</title>
    <link th:href="@{/css/styles.css}" rel="stylesheet" />
  </head>
  <body>
    <h1>Call List</h1>
    <form action="#" th:action="@{/}" th:method="get">
      <button type="submit" name="timeRange" value="1">Past 24 Hours</button>
      <button type="submit" name="timeRange" value="3">Past 3 Days</button>
      <button type="submit" name="timeRange" value="7">Past Week</button>
      <button type="submit" name="timeRange" value="30">Past Month</button>
    </form>

    <div th:each="call : ${calls}">
      <div class="card">
        <div th:text="${call.displayDateTime}"></div>
        <div class="typeContainer">
          <button
            class="location buttonBox"
            th:text="${call.callType}"
            th:onclick="updateParamsAndSubmit('type', [[${call.callType}]])"
          ></button>
        </div>
        <div class="locationContainer">
          <button
            class="location buttonBox"
            th:text="${call.callLocation}"
            th:onclick="updateParamsAndSubmit('location', [[${call.callLocation}]])"
          ></button>
        </div>
      </div>
    </div>
    <script th:inline="javascript">
      function updateParamsAndSubmit(name, value) {
        var currentUrl = window.location.href;

        var params = {};

        var urlParams = new URLSearchParams(window.location.search);
        urlParams.forEach(function (value, key) {
          params[key] = value;
        });

        params[name] = value;

        var newUrl =
          currentUrl.split("?")[0] + "?" + new URLSearchParams(params);

        // Redirect to the new URL
        window.location.href = newUrl;
      }
    </script>
  </body>
</html>
